我将为您实现“用户登录系统”和“对话历史持久化”功能，这需要对后端和前端进行全栈改造。

### 核心实施计划

#### 1. 后端改造 (Java + MySQL)

* 引入依赖 (`pom.xml`)：

  * 添加 `mysql-connector-j` (MySQL 驱动)。

  * 添加 `mybatis-plus-spring-boot-starter` (简化数据库操作)。

* **数据库配置 (`application.yml`)**：

  * 配置 MySQL 数据源连接信息（URL, 用户名, 密码）。

* **数据模型设计**：

  * 创建 `User` 实体：存储 `id`, `username`, `password` (简化起见明文或简单加密), `createTime`。

  * 创建 `ChatMessage` 实体：存储 `id`, `userId`, `assistantType` (助手类型), `role` (user/ai), `content`, `createTime`。

* **数据访问层 (Mapper)**：

  * 创建 `UserMapper` 和 `ChatMessageMapper` 接口。

* **业务逻辑层 (Service)**：

  * `UserService`：实现登录 (Login) 和注册 (Register) 逻辑。

  * `ChatHistoryService`：实现保存消息和查询历史消息逻辑。

* **API 接口 (Controller)**：

  * `UserController`：开放 `/api/user/login` 和 `/api/user/register`。

  * `ChatHistoryController`：开放 `/api/chat/history` 用于获取历史记录。

  * **拦截器**：添加简单的 `LoginInterceptor`，拦截 `/api/ai/**` 和 `/api/chat/**` 请求，确保只有登录用户能访问。

* **改造 AI 接口**：

  * 修改 `AiController`，在流式响应开始前保存用户消息，在响应结束后保存 AI 消息到数据库。

#### 2. 前端改造 (Vue.js)

* **新增登录/注册页**：

  * 创建 `Login.vue` 组件，包含精美的登录/注册表单（保持整体 UI 风格）。

* **状态管理**：

  * 在 `App.vue` 中增加 `isLoggedIn` 和 `currentUser` 状态。

  * 如果未登录，显示 `Login` 组件；登录成功后显示主界面。

* **API 适配**：

  * 创建 `userApi.js` 处理登录注册请求。

  * 更新 `chatApi.js`，增加获取历史记录的方法。

* **交互逻辑更新**：

  * **登录后**：自动加载上次使用的助手类型和对应的历史对话。

  * **切换助手时**：清空当前屏幕消息，并从后端加载该助手的历史记录。

  * **发送消息时**：前端直接显示，后端异步保存。

### 数据库表结构预览

1. **`user`** **表**：

   * `id` (BIGINT, PK)

   * `user_account` (VARCHAR)

   * `user_password` (VARCHAR)
2. **`chat_message`** **表**：

   * `id` (BIGINT, PK)

   * `user_id` (BIGINT)

   * `assistant_type` (VARCHAR) - 如 'code', 'travel'

   * `role` (VARCHAR) - 'user' 或 'ai'

   * `content` (TEXT)

   * `create_time` (DATETIME)

### 注意事项

由于这是一个 Demo 项目，我将使用简单的 Session/Cookie 机制进行身份验证，不引入复杂的 Spring Security，以保持代码轻量易读。
