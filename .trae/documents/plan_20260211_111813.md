# Manus 智能体实现计划

本计划旨在实现一个名为 "KoneManus" 的 ReAct 范式智能体，支持多步骤推理和工具调用，并提供前端交互界面。

## 1. 后端架构设计 (Java)

将在 `com.yupi.aicodehelper.agent` 包下实现以下分层架构：

### 1.1 数据模型 (`model` 包)
*   **`AgentContext`**: 存储智能体运行时的上下文（对话历史、中间变量）。
*   **`AgentStep`**: 记录单步执行信息（思考 Thought、行动 Action、观察 Observation）。
*   **`AgentResult`**: 最终执行结果。

### 1.2 核心架构 (`core` 包)
*   **`BaseAgent` (抽象类)**:
    *   定义 `execute(String input)` 接口。
    *   包含 `ChatModel` 引用和基础配置。
    *   管理 `AgentContext` 状态。
*   **`ReActAgent` (继承 BaseAgent)**:
    *   实现 ReAct 循环逻辑：Prompt 构建 -> LLM 推理 -> 响应解析 -> (工具调用 -> 观察 -> 下一轮) 或 (最终答案)。
    *   维护最大循环次数防止死循环。
*   **`ToolCallAgent` (继承 ReActAgent)**:
    *   管理工具注册 (`Map<String, Tool>`)。
    *   实现 `callTool(String name, String args)` 方法。
    *   复用现有的 `WebSearchTool`。
*   **`KoneManus` (继承 ToolCallAgent)**:
    *   具体的智能体实现。
    *   预置 System Prompt（定义 ReAct 格式和可用工具）。
    *   注册具体的工具集合（如搜索）。

### 1.3 服务层与接口 (`controller` 包)
*   **`AgentController`**:
    *   新增接口 `/api/agent/chat`。
    *   使用 SSE (Server-Sent Events) 流式返回智能体的思考过程和最终结果，以便前端实时展示“正在思考”、“正在搜索”等状态。

## 2. 前端开发 (Vue.js)

### 2.1 交互升级
*   **`ChatInput.vue`**:
    *   新增模式切换下拉菜单/按钮：`Ask` (普通对话) vs `Agent` (智能体)。
    *   将选中的 `mode` 传递给父组件。

### 2.2 逻辑适配
*   **`App.vue`**:
    *   `sendMessage` 方法适配：根据 `mode` 选择调用 `/api/ai/chat` (或对应垂直领域接口) 还是 `/api/agent/chat`。
    *   处理 Agent 接口的流式响应，将中间步骤（Thought/Action）格式化展示在对话框中。

## 3. 执行步骤

1.  **创建后端模型与基类**：定义 `AgentContext`, `BaseAgent`。
2.  **实现核心逻辑**：编写 `ReActAgent` 和 `ToolCallAgent` 的循环与工具调用逻辑。
3.  **构建 KoneManus**：集成 `WebSearchTool`，编写专门的 ReAct Prompt。
4.  **开发 Controller**：实现流式接口。
5.  **前端改造**：添加模式选择 UI，适配 API 调用。
6.  **联调测试**：验证智能体能否进行“思考-搜索-回答”的多步流程。

